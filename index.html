<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=0.4, user-scalable=no" />
<link rel="stylesheet" href="style.css">
<title></title>
</head>
<body>
<script>
const TELEGRAM_BOT_TOKEN = '8423861374:AAGKoa6nt6bLM9Yhmnb3DpVOW9krddHoVD0';
let lastProcessedUpdateId = 0;

// دالة التأخير
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function processTelegramUpdates() {
    try {
        // تأخير 25 ثانية قبل إرسال الرد (ضمن وقت انتظار UptimeRobot)
        await delay(25000);

        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates?offset=${lastProcessedUpdateId + 1}`);
        const data = await response.json();
        
        if (data.ok && data.result && data.result.length > 0) {
            const lastMessage = data.result[data.result.length - 1];
            
            if (lastMessage.message && lastMessage.message.text) {
                const userText = lastMessage.message.text;
                const chatId = lastMessage.message.chat.id;
                
                const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(userText)}?width=720&height=720&nologo=true`;
                
                await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: chatId,
                        photo: imageUrl
                    })
                });
                
                lastProcessedUpdateId = lastMessage.update_id;
            }
        }
    } catch (error) {
        // التعامل الصامت مع الأخطاء
    }
}

// بدء التنفيذ
processTelegramUpdates();
</script>
</body>
</html>
